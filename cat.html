<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منتجات القسم</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Tajawal", sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
      color: #222;
      min-height: 100vh;
      direction: rtl;
    }

    /* Header */
    .header {
    background: linear-gradient(135deg, #ffc107 0%, #000000 100%);
    padding: 20px 15px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
    position: sticky;
    top: 0;
    z-index: 100;
}

    .header h1 {
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .breadcrumb {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      font-weight: 300;
    }

    /* Main Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 15px;
    }

    /* Loader */
    .loader-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 60vh;
    }

    .loader {
      width: 70px;
      height: 70px;
      border: 5px solid rgba(13, 110, 253, 0.1);
      border-top-color: #0d6efd;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Products Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); 
      gap: 16px;
      padding: 15px 0;
    }

    /* Responsive Grid */
    @media (min-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(3, 1fr); 
        gap: 20px;
      }
    }

    @media (min-width: 1024px) {
      .products-grid {
        grid-template-columns: repeat(5, 1fr); 
        gap: 24px;
      }
    }

    /* Product Card */
    .product-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      animation: cardAppear 0.5s ease-out forwards;
      opacity: 0;
      transform: translateY(20px);
    }

    .product-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
    }

    @keyframes cardAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Product Image Container */
    .image-container {
      width: 100%;
      height: 200px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .product-card:hover .product-image {
      transform: scale(1.05);
    }

    .image-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.1), transparent);
    }

    /* Product Content */
    .product-content {
      padding: 18px 16px;
    }

    .product-name {
      font-size: 1rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 10px;
      line-height: 1.4;
      height: 44px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .product-details {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #64748b;
    }

    .detail-item i {
      color: #0d6efd;
      width: 16px;
      text-align: center;
    }

    /* Action Button */
    .action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #ffc107 0%, #ffc107 100%);
    color: #000;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

    .action-btn:hover {
      background: linear-gradient(135deg, #084dbf 0%, #063a92 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(13, 110, 253, 0.25);
    }

    .action-btn i {
      font-size: 1rem;
      transition: transform 0.3s ease;
    }

    .action-btn:hover i {
      transform: translateX(4px);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 40px;
      padding: 20px 0;
    }

    .pagination-btn {
      padding: 12px 24px;
      background: white;
      color: #0d6efd;
      border: 2px solid #0d6efd;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: "Tajawal", sans-serif;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #0d6efd;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(13, 110, 253, 0.25);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      color: #64748b;
      font-weight: 500;
      background: white;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      grid-column: 1 / -1;
    }

    .empty-state i {
      font-size: 4rem;
      color: #cbd5e1;
      margin-bottom: 20px;
    }

    .empty-state h3 {
      color: #64748b;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .empty-state p {
      color: #94a3b8;
      font-size: 0.95rem;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 20px;
      color: #64748b;
      font-size: 0.9rem;
      border-top: 1px solid #e2e8f0;
      margin-top: 40px;
    }

    .sub-categories {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  margin-bottom: 25px;
}

.sub-category {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #fff;
  padding: 10px 14px;
  border-radius: 14px;
  text-decoration: none;
  color: #000;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
  white-space: nowrap;
}

.sub-category img {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  object-fit: cover;
}

  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <h1 id="categoryName">منتجات القسم</h1>
    <div class="breadcrumb" id="breadcrumb">جاري التحميل...</div>
  </div>

  <!-- Loader -->
  <div id="loader" class="loader-container">
    <div class="loader"></div>
  </div>

  <!-- Main Content -->
  <div class="container" style="display: none;">
    <div id="subCategories" class="sub-categories"></div>

    <div id="products" class="products-grid"></div>
    
    <!-- Pagination -->
    <div id="pagination" class="pagination" style="display: none;">
      <button id="prevBtn" class="pagination-btn" onclick="prevPage()" disabled>
        <span>السابق</span>
      </button>
      
      <div id="pageInfo" class="page-info">صفحة 1</div>
      
      <button id="nextBtn" class="pagination-btn" onclick="nextPage()" disabled>
        <span>التالي</span>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    © 2026  45 بوتيك اليمن صنعاء حده امام مطعم الخضراء جميع الحقوق محفوظة.
  </div>

  <!-- Font Awesome Icons -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
 <script src="https://cdn.counter.dev/script.js" data-id="63a59253-ddc0-4cf1-903c-fbaa3e5d4544" data-utcoffset="3"></script>
  <script>
    const API_BASE = "https://api.45botique.com/api/categories";
    const API_KEY = "erh124e33r4sd9abcdef";

    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get("slug");
    let currentPage = 1;
    let totalPages = 1;
    let nextPageUrl = null;
    let prevPageUrl = null;

    document.getElementById("categoryName").textContent = `منتجات القسم`;
    document.getElementById("breadcrumb").innerHTML = `
  <a href="javascript:void(0)" onclick="goBack()" style="color:#fff;text-decoration:underline;">
    الصفحة الرئيسية
  </a>
  / ${slug}
`;

function goBack() {
  window.history.back();
}

fetchCategoryInfo(slug);
    fetchCategoryProducts(`${API_BASE}/${slug}/products`);

    async function fetchCategoryInfo(slug) {
  const res = await fetch(`${API_BASE}/${slug}`, {
    headers: { "X-API-KEY": API_KEY }
  });

  const json = await res.json();
  if (!json.data) return;

  document.getElementById("categoryName").textContent = json.data.name;
  document.getElementById("breadcrumb").textContent =
    `الرئيسية / ${json.data.name}`;

  renderSubCategories(json.data.children);
}

    
    async function fetchCategoryProducts(url) {
      try {
        document.getElementById("loader").style.display = "flex";
        const container = document.querySelector(".container");
        container.style.display = "none";
        const pagination = document.getElementById("pagination");
        pagination.style.display = "none";

        const res = await fetch(url, {
          headers: { "X-API-KEY": API_KEY }
        });

        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }

        const json = await res.json();

        if (!json.data || json.data.length === 0) {
          showEmptyState();
          return;
        }

        displayProducts(json.data);

        currentPage = json.current_page || 1;
        totalPages = json.last_page || 1;
        nextPageUrl = json.next_page_url;
        prevPageUrl = json.prev_page_url;

        updatePagination();

        document.getElementById("loader").style.display = "none";
        container.style.display = "block";
        pagination.style.display = "flex";

      } catch (err) {
        console.error('Error:', err);
        showError("حدث خطأ في تحميل المنتجات");
      }
    }

    function displayProducts(products) {
      const container = document.getElementById("products");
      container.innerHTML = "";

      products.forEach((product, index) => {
        const card = document.createElement("div");
        card.classList.add("product-card");
        
        card.style.animationDelay = `${index * 0.1}s`;

        const imgSrc = product.image ? product.image : 
          `https://api.45botique.com/storage/images/404.png`;

        card.innerHTML = `
          <div class="image-container">
            <img src="${imgSrc}" 
                 class="product-image" 
                 loading="lazy" 
                 alt="${product.name || 'منتج'}"
                 onerror="this.src='https://api.45botique.com/storage/images/404.png'">
            <div class="image-overlay"></div>
          </div>
          
          <div class="product-content">
            <h3 class="product-name">${product.name || 'منتج بدون اسم'}</h3>
            
            <div class="product-details">
              <div class="detail-item">
                <i class="fas fa-barcode"></i>
                <span>${product.sku || 'غير محدد'}</span>
              </div>
              
              <div class="detail-item">
                <i class="fas fa-tag"></i>
                <span>${product.price ? `${product.price} د.ك` : 'غير محدد'}</span>
              </div>
              
              ${product.media_count ? `
                <div class="detail-item">
                  <i class="fas fa-images"></i>
                  <span>${product.media_count} صورة</span>
                </div>
              ` : ''}
            </div>
            
            <a href="product.html?slug=${product.slug || ''}" 
               class="action-btn">
              <span>عرض المنتج</span>
              <i class="fas fa-arrow-left"></i>
            </a>
          </div>
        `;

        container.appendChild(card);
      });
    }
    function renderSubCategories(children) {
  if (!children || children.length === 0) return;

  const container = document.getElementById("subCategories");
  container.innerHTML = "";

  children.forEach(cat => {
    const div = document.createElement("a");
    div.href = `cat.html?slug=${cat.slug}`;
    div.className = "sub-category";

    div.innerHTML = `
      ${cat.image ? `<img src="${cat.image}">` : ""}
      <span>${cat.name}</span>
    `;

    container.appendChild(div);
  });
}


    function updatePagination() {
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const pageInfo = document.getElementById("pageInfo");

      // تحديث أزرار التصفح
      prevBtn.disabled = !prevPageUrl;
      nextBtn.disabled = !nextPageUrl;

      // تحديث معلومات الصفحة
      pageInfo.textContent = `صفحة ${currentPage} من ${totalPages}`;

      // تحديث التصميم بناءً على الحالة
      prevBtn.innerHTML = prevPageUrl ? 
        '<i class="fas fa-arrow-right"></i><span>السابق</span>' : 
        '<span>السابق</span>';
      
      nextBtn.innerHTML = nextPageUrl ? 
        '<span>التالي</span><i class="fas fa-arrow-left"></i>' : 
        '<span>التالي</span>';
    }

    function nextPage() {
      if (nextPageUrl) {
        fetchCategoryProducts(nextPageUrl);
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function prevPage() {
      if (prevPageUrl) {
        fetchCategoryProducts(prevPageUrl);
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function showEmptyState() {
      const container = document.getElementById("products");
      container.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-box-open"></i>
          <h3>لا توجد منتجات</h3>
          <p>لم يتم العثور على منتجات في هذا القسم</p>
        </div>
      `;
      
      document.getElementById("loader").style.display = "none";
      document.querySelector(".container").style.display = "block";
      document.getElementById("pagination").style.display = "none";
    }

    function showError(message) {
      const container = document.getElementById("products");
      container.innerHTML = `
        <div class="empty-state" style="color: #dc2626;">
          <i class="fas fa-exclamation-triangle"></i>
          <h3>خطأ في التحميل</h3>
          <p>${message}</p>
          <button onclick="fetchCategoryProducts('${API_BASE}/${slug}/products')" 
                  style="margin-top: 20px; padding: 10px 20px; background: #0d6efd; color: white; border: none; border-radius: 8px; cursor: pointer;">
            إعادة المحاولة
          </button>
        </div>
      `;
      
      document.getElementById("loader").style.display = "none";
      document.querySelector(".container").style.display = "block";
      document.getElementById("pagination").style.display = "none";
    }
  </script>
</body>
</html>




