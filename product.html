<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <style>
    body {
      font-family: "Tajawal", sans-serif;
      background: #f1f3f6;
      margin: 0;
      padding: 20px;
      direction: rtl;
      text-align: right;
    }

    .loader {
      width: 60px;
      height: 60px;
      border: 6px solid #ddd;
      border-top-color: #0d6efd;
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
      margin: 80px auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 4px 14px rgba(0,0,0,0.1);
      display: none;
      padding-bottom: 30px;
    }

    .mainSwiper {
      width: 100%;
      height: 380px;
      background: #eee;
      position: relative;
    }
    .mainSwiper img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      cursor: pointer;
    }

    .thumbs {
      height: 100px;
      padding: 10px;
    }
    .thumbs img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid #ddd;
    }
    .thumbs .swiper-slide-thumb-active img {
      border-color: #0d6efd;
    }

    .content {
      padding: 20px;
    }

    .name {
      font-size: 1.6rem;
      font-weight: bold;
      color: #0d6efd;
    }

    .info {
      margin: 5px 0;
      font-size: 1.05rem;
      color: #444;
    }

    .btns {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      background: #0d6efd;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 1rem;
      border: none;
      cursor: pointer;
    }

    .back { background: #6c757d; }

    /* Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ */
    .fullscreen-gallery {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .fullscreen-gallery.active {
      display: flex;
    }

    .gallery-container {
      width: 90%;
      height: 90%;
      position: relative;
    }

    .gallery-swiper {
      width: 100%;
      height: 100%;
    }

    .gallery-swiper .swiper-slide {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .gallery-swiper img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .gallery-controls {
      position: absolute;
      bottom: 30px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 15px;
      z-index: 10;
    }

    .gallery-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .gallery-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .gallery-close {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 10;
      transition: background 0.3s;
    }

    .gallery-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .gallery-counter {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      font-size: 18px;
      background: rgba(0, 0, 0, 0.5);
      padding: 5px 15px;
      border-radius: 20px;
      z-index: 10;
    }

    .zoom-controls {
      position: absolute;
      top: 20px;
      left: 90px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .zoom-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .zoom-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .swiper-zoom-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    .swiper-zoom-container > img {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>

<body>

  <div id="loader" class="loader"></div>

  <div class="container" id="product-container"></div>

  <!-- Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„ -->
  <div class="fullscreen-gallery" id="fullscreenGallery">
    <button class="gallery-close" id="closeGallery">âœ•</button>
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoomIn">+</button>
      <button class="zoom-btn" id="zoomOut">-</button>
      <button class="zoom-btn" id="resetZoom">â†º</button>
    </div>
    <div class="gallery-counter" id="galleryCounter">1 / 5</div>
    <div class="gallery-container">
      <div class="gallery-swiper swiper">
        <div class="swiper-wrapper" id="galleryWrapper"></div>
      </div>
    </div>
    <div class="gallery-controls">
      <button class="gallery-btn" id="prevGallery">â®</button>
      <button class="gallery-btn" id="nextGallery">â¯</button>
    </div>
  </div>

  <!-- Swiper -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script>
    const API_KEY = "erh124e33r4sd9abcdef";
    const API_URL = "https://api.45botique.com/api/products";

    const slug = new URLSearchParams(window.location.search).get("slug");
    let productImages = [];

    if (!slug) {
      document.getElementById("product-container").innerHTML =
        "<p style='padding:20px;'>Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬.</p>";
      document.getElementById("loader").style.display = "none";
      document.getElementById("product-container").style.display = "block";
    } else {
      fetchProduct(slug);
    }

    async function fetchProduct(slug) {
      try {
        const res = await fetch(`${API_URL}/${slug}`, {
          headers: { "X-API-KEY": API_KEY }
        });

        const json = await res.json();
        renderProduct(json.data);

      } catch (err) {
        document.getElementById("product-container").innerHTML =
          "<p style='padding:20px;color:red;'>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬.</p>";
        document.getElementById("loader").style.display = "none";
        document.getElementById("product-container").style.display = "block";
      }
    }

    function renderProduct(product) {
      // ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±
      productImages = [];
      if (product.image) productImages.push(product.image);
      if (product.media_images?.length)
        product.media_images.forEach(x => productImages.push(x.image));

      let mainSlides = "";
      let thumbsSlides = "";

      productImages.forEach((img, i) => {
        mainSlides += `
          <div class="swiper-slide">
            <div class="swiper-zoom-container">
              <img src="${img}" loading="lazy" data-index="${i}" class="main-image">
            </div>
          </div>
        `;

        thumbsSlides += `
          <div class="swiper-slide">
            <img src="${img}" loading="lazy" data-index="${i}" class="thumb-image">
          </div>
        `;
      });

      const container = document.getElementById("product-container");

      container.innerHTML = `
        <div class="mainSwiper swiper">
          <div class="swiper-wrapper">${mainSlides}</div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
        </div>

        <div class="thumbs swiper">
          <div class="swiper-wrapper">${thumbsSlides}</div>
        </div>

        <div class="content">
          <div class="name">${product.name}</div>

          <div class="info">Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù: ${product.sku}</div>
          <div class="info">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${product.barcode}</div>

          ${product.description ? `<div class="info">Ø§Ù„ÙˆØµÙ: ${product.description}</div>` : ""}

          <div class="btns">
            <a class="btn"
               href="https://wa.me/967770045145?text=${encodeURIComponent(
                 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬: ' + product.name +
                 '\nØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ' + (product.barcode || 'ØºÙŠØ± Ù…ØªÙˆÙØ±') +
                 '\nØ±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬:\n' + window.location.href
               )}"
               target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“¤</a>

            <button class="btn" onclick="copyLink()">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ”—</button>

            <a href="index.html" class="btn back">â¬… Ø±Ø¬ÙˆØ¹</a>
          </div>
        </div>
      `;

      document.getElementById("loader").style.display = "none";
      container.style.display = "block";

      initSlider();
    }

    function initSlider() {
      const thumbs = new Swiper(".thumbs", {
        slidesPerView: 5,
        spaceBetween: 10,
        watchSlidesProgress: true,
      });

      const main = new Swiper(".mainSwiper", {
        spaceBetween: 10,
        pagination: {
          el: '.swiper-pagination',
          clickable: true
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        thumbs: { swiper: thumbs },
        touchRatio: 1,
        grabCursor: true,
        zoom: {
          maxRatio: 3,
          minRatio: 1
        },
      });

      setTimeout(() => {
        document.querySelectorAll('.main-image').forEach((img, index) => {
          img.addEventListener('click', () => {
            openFullscreenGallery(index);
          });
        });

        document.querySelectorAll('.thumb-image').forEach((thumb, index) => {
          thumb.addEventListener('click', () => {
            openFullscreenGallery(index);
          });
        });
      }, 100);

      window.currentSwiper = main;
    }

    function openFullscreenGallery(startIndex = 0) {
      const gallery = document.getElementById('fullscreenGallery');
      const galleryWrapper = document.getElementById('galleryWrapper');
      
      galleryWrapper.innerHTML = '';
      
      productImages.forEach((img, i) => {
        galleryWrapper.innerHTML += `
          <div class="swiper-slide">
            <div class="swiper-zoom-container">
              <img src="${img}" data-index="${i}">
            </div>
          </div>
        `;
      });
      
      if (window.fullscreenSwiper) {
        window.fullscreenSwiper.destroy();
      }
      
      window.fullscreenSwiper = new Swiper('.gallery-swiper', {
        initialSlide: startIndex,
        spaceBetween: 10,
        zoom: {
          maxRatio: 5,
          minRatio: 1
        },
        navigation: {
          nextEl: '#nextGallery',
          prevEl: '#prevGallery',
        },
        on: {
          slideChange: function() {
            updateCounter(this.activeIndex + 1, productImages.length);
            resetZoom();
          },
          init: function() {
            updateCounter(this.activeIndex + 1, productImages.length);
          }
        }
      });
      
      gallery.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      setupZoomControls();
    }

    function setupZoomControls() {
      const zoomInBtn = document.getElementById('zoomIn');
      const zoomOutBtn = document.getElementById('zoomOut');
      const resetZoomBtn = document.getElementById('resetZoom');
      
      zoomInBtn.onclick = function() {
        if (window.fullscreenSwiper && window.fullscreenSwiper.zoom) {
          window.fullscreenSwiper.zoom.in();
        }
      };
      
      zoomOutBtn.onclick = function() {
        if (window.fullscreenSwiper && window.fullscreenSwiper.zoom) {
          window.fullscreenSwiper.zoom.out();
        }
      };
      
      resetZoomBtn.onclick = resetZoom;
      
      const gallerySwiper = document.querySelector('.gallery-swiper');
      if (gallerySwiper) {
        gallerySwiper.addEventListener('wheel', function(e) {
          if (e.ctrlKey) {
            e.preventDefault();
            if (e.deltaY < 0) {
              if (window.fullscreenSwiper && window.fullscreenSwiper.zoom) {
                window.fullscreenSwiper.zoom.in();
              }
            } else {
              if (window.fullscreenSwiper && window.fullscreenSwiper.zoom) {
                window.fullscreenSwiper.zoom.out();
              }
            }
          }
        });
      }
    }

    function resetZoom() {
      if (window.fullscreenSwiper && window.fullscreenSwiper.zoom) {
        window.fullscreenSwiper.zoom.scale = 1;
      }
    }

    function updateCounter(current, total) {
      const counter = document.getElementById('galleryCounter');
      counter.textContent = `${current} / ${total}`;
    }

    function closeFullscreenGallery() {
      const gallery = document.getElementById('fullscreenGallery');
      gallery.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    function copyLink() {
      navigator.clipboard.writeText(window.location.href)
        .then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!"));
    }

    document.getElementById('closeGallery').addEventListener('click', closeFullscreenGallery);
    
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeFullscreenGallery();
      }
      
      if (document.getElementById('fullscreenGallery').classList.contains('active')) {
        if (e.key === 'ArrowLeft') {
          document.getElementById('prevGallery').click();
        } else if (e.key === 'ArrowRight') {
          document.getElementById('nextGallery').click();
        }
      }
    });

    document.getElementById('fullscreenGallery').addEventListener('click', function(e) {
      if (e.target === this) {
        closeFullscreenGallery();
      }
    });
  </script>

</body>
</html>
